---
import Layout from '~/layouts/PageLayout.astro';
import { client, urlFor } from '~/lib/sanity';
import { PortableText } from 'astro-portabletext';
import { format } from 'date-fns';

// Bu fonksiyon, Sanity'deki tüm blog yazılarını bulur ve her biri için bir sayfa oluşturulmasını sağlar
export async function getStaticPaths() {
  const posts = await client.fetch(`*[_type == "post"]{ "slug": slug.current }`);
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;
const post = await client.fetch(`*[_type == "post" && slug.current == "${slug}"][0]`);

const metadata = {
  title: post.title,
  description: post.excerpt,
};
---

<Layout metadata={metadata}>
  <section class="px-6 sm:px-6 py-12 sm:py-16 lg:py-20 mx-auto max-w-3xl">
    <header>
      <img 
        src={urlFor(post.mainImage).width(1200).height(600).url()} 
        alt={post.title} 
        class="mb-8 rounded-lg shadow-lg w-full h-auto object-cover"
      />
      <h1 class="text-4xl md:text-5xl font-bold leading-tighter tracking-tighter mb-4 font-heading">
        {post.title}
      </h1>
      <p class="text-lg text-muted">
        Yayınlanma Tarihi: <time datetime={post.publishedAt}>{format(new Date(post.publishedAt), 'dd MMMM yyyy')}</time>
      </p>
    </header>
    <div class="prose prose-lg dark:prose-invert max-w-none mt-8">
      <PortableText value={post.body} />
    </div>
  </section>
</Layout>