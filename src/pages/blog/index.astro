---
import Layout from '~/layouts/PageLayout.astro';
import { client, urlFor } from '~/lib/sanity';
import { format } from 'date-fns'; // Tarihleri formatlamak için

// Sanity'den tüm blog yazılarını en yeniden eskiye doğru sıralayarak çekiyoruz
const posts = await client.fetch(`*[_type == "post"] | order(publishedAt desc)`);

const metadata = {
  title: 'Blog',
  description: 'Sağlıklı yaşam, beslenme ve diyet hakkında en güncel yazılar.',
};
---

<Layout metadata={metadata}>
  <section class="px-6 sm:px-6 py-12 sm:py-16 lg:py-20 mx-auto max-w-4xl">
    <header>
      <h1 class="text-center text-4xl md:text-5xl font-bold leading-tighter tracking-tighter mb-4 md:mb-6">
        Blog
      </h1>
    </header>

    {/* Blog Yazıları Listesi */}
    <ul>
      {posts.map((post) => (
        <li class="mb-12">
          <article class="group">
            <a href={`/blog/${post.slug.current}`}>
              <div class="grid grid-cols-1 md:grid-cols-4 md:gap-6">
                {/* Görsel Alanı */}
                <div class="md:col-span-1 mb-4 md:mb-0">
                  <img 
                    src={urlFor(post.mainImage).width(400).height(250).url()}
                    alt={post.title}
                    class="rounded-lg shadow-md w-full h-auto object-cover transition-transform duration-300 ease-in-out group-hover:scale-105"
                  />
                </div>
                {/* Metin Alanı */}
                <div class="md:col-span-3">
                  <h2 class="text-2xl font-bold leading-tight mb-2 font-heading transition-colors duration-300 ease-in-out group-hover:text-primary">
                    {post.title}
                  </h2>
                  <p class="text-muted">
                    <time datetime={post.publishedAt}>
                      {format(new Date(post.publishedAt), 'dd MMMM yyyy')}
                    </time>
                  </p>
                  <p class="mt-4 text-gray-700 dark:text-slate-400">
                    {post.excerpt}
                  </p>
                </div>
              </div>
            </a>
          </article>
        </li>
      ))}
    </ul>
  </section>
</Layout>